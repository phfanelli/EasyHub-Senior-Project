<!DOCTYPE html>
<html>
<head>
    <link rel="import" href="../bower_components/paper-button/paper-button.html">
    <link rel="import" href="../bower_components/polymer/polymer.html">
    <link rel="import" href="../bower_components/paper-input/paper-input.html">
    <link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="../bower_components/paper-item/paper-item.html">
    <link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
    <link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
    <link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
    <link rel="import" href="../bower_components/iron-icons/iron-icons.html">
    <link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="../bower_components/paper-toast/paper-toast.html">
    <link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
    <link rel="import" href="../bower_components/paper-input/paper-textarea.html">
    <link rel="import" href="../bower_components/paper-badge/paper-badge.html">
    <link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">

</head>

<dom-module id="easy-hub-main">
    <style is="custom-style">
        paper-textarea{
            --paper-input-container-input: {
                color: snow;
            }
        }
        /* CSS rules for your element */
        #mainContainer {
            display: flex;
            flex-direction: column;
        }

        #commandPanel paper-button {
            background-color: silver;
            margin-top: 5px;
        }

        #statusButton {
            background-color: red;
            width: 15px;
            height: 15px;
            top: 10px;
        }
        #cloneDialog {
            width: 400px;
            padding-top: 20px;
        }
        #mainWrap {
            display: flex;
            padding-right: 0px;
        }
        #repoSource {
            float: left;
            width: 60%;
        }
        #createLocal {
            display: flex;
            align-items: center;
        }
        #verticalLine {
            border-left: thick solid black;
        }
        .cloneButton  {
            background-color: purple;
            color: lightgray;
        }
        #cloneDest ::content #input{
            text-overflow: ellipsis;
        }
        #mainContainer paper-dropdown-menu {
            display: flex;
            justify-content: space-around;
            --paper-input-container-input: {
                color: var(--paper-blue-grey-50);
            };
            --paper-input-container-label: {
                color: white;
            };
            --paper-input-container-input: {
                color: white;
            };
            --paper-input-container-label-focus: {
                color: white;
            };
            --paper-input-container-label-floating: {
                color: white;
            };
            --paper-input-container-underline: {
                background: white;
            };
            --paper-input-container-underline-focus: {
                background: white;
            };
            --paper-input-container-underline-focus: {
                display: none;
            };
            --paper-input-container-underline-disabled: {
                display: none;
            };
        }
        #mainContainer paper-dropdown-menu ::content #dropdown{
            top: 42px !important;
        }

        #terminal{
            text-align: left;
            background-color: black;
            color: snow;
            width: 100%;
            overflow-y: auto;
        }

        #statusContainer {
            display: inline-block;
            margin-left: 30px;
            margin-right: 30px;
        }

        #statusContainer > paper-badge {
            --paper-badge-margin-left: 20px;
            --paper-badge-margin-bottom: 0px;
            --paper-badge-background: var(--paper-purple-200);
        }

        .terminalSettings{
            font-size: 8pt;
            position: absolute;
            bottom: 0%;
            border: white 1px solid;
            padding: 0px;
        }

        .heading{
            padding: 10px 15px;
            background-color: #f3f3f3;
            border: 1px solid #dedede;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            width: 100%;
            text-align: center;
        }

        .collapse-content {
            padding: 15px;
            border: 1px solid #dedede;
        }

        #terminal {
            /*Yes i know they're red. They're supposed to be*/
            font-size: var(--terminal-font-size);
            font-family: var(--terminal-font-family);
        }

    </style>

    <template>

        <paper-dialog id="dialog" modal>
             <paper-icon-button icon="icons:close" dialog-dismiss style="margin-top: 0px; top: 0px; position: absolute; right: 0px;"></paper-icon-button>
             <paper-input id="commandInput" label="{{commandType}}"></paper-input>
             <paper-button raised class="cloneButton" on-tap="_setVal" value="12">OKAY</paper-button>
        </paper-dialog>

        <paper-dialog id="styleDialog" modal>
            <paper-icon-button icon="icons:close" dialog-dismiss style="margin-top: 0px; top: 0px; position: absolute; right: 0px;"></paper-icon-button>
            <paper-input id="fontInput" type="number" max="32" min="6" label="Font Size" value="10"></paper-input>
            <paper-dropdown-menu class="custom" id="fontSelector" label="Font Type">
                <paper-listbox class="dropdown-content" selected="2">
                    <paper-item>Arial</paper-item>
                    <paper-item>Times New Roman</paper-item>
                    <paper-item>Courier New</paper-item>
                </paper-listbox>
            </paper-dropdown-menu>
            <paper-button raised class="cloneButton" on-tap="_setTerminalStyles">O.K.</paper-button>
        </paper-dialog>

        <paper-toast id="toastNotify"></paper-toast>
        <paper-dialog id="cloneDialog" modal>
            <paper-icon-button icon="icons:close" dialog-dismiss style="margin-top: 0px; top: 0px; position: absolute; right: 0px;"></paper-icon-button>
            <h2>Clone Repository</h2>
            <div id="mainWrap">
                <div id="repoSource">
                    <div style="display:flex; float: left; align-items:center; ">
                        <paper-input id="cloneRemote" label="Remote Repository URL"></paper-input>
                    </div>
                    <div style="display:flex; float: left; align-items:center; ">
                        <paper-input id="cloneDest" readonly label="Destination Directory" value="{{repoFormDestination}}"></paper-input>
                        <paper-icon-button icon="icons:folder" on-tap="_openFolderDialog">Add Repo</paper-icon-button>
                    </div>
                    <paper-button raised class="cloneButton" on-tap="_clone" style="margin-top: 15px;">add</paper-button>
                </div>
                <div id="verticalLine"></div>
                <div id="createLocal">
                    <paper-button raised class="cloneButton"  on-tap="_initLocal" style="height: 40px">create local</paper-button>
                </div>
            </div>
        </paper-dialog>

        <paper-dialog id="newBranchDialog" modal>
            <h2>New Local Branch</h2>
            <paper-input id="newBranchName" label="Branch Name:"></paper-input>
            <paper-button raised on-tap="_newLocalBranch">Ok</paper-button>
            <paper-button raised on-tap="_cancelNewBranch">Cancel</paper-button>
        </paper-dialog>

        <div id="mainWrapper" style="display: flex; width: 100%; height: 100%">
            <div id="mainContainer" style="width: 50%;">
                <paper-toolbar style="background: slategrey;">
                    <img src="../easy_hub_logo.png" alt="" style="width:40px;height:40px;margin-right: 15px;">
                    <div id="repoContainer" style="display: flex; align-items: flex-end; padding-bottom: 10px;">
                        <paper-dropdown-menu class="custom" id="repoSelector" label="Repository Selection">
                            <paper-listbox class="dropdown-content">
                                <template is="dom-repeat" items="{{applicationData.repoArray}}">
                                    <paper-item>{{item.name}}</paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>
                        <paper-icon-button id="repoAdd" icon="icons:add" tooltip="Add a repo" on-tap="_toggleClone">Add Repo</paper-icon-button>
                        <paper-dropdown-menu class="custom" id="branchSelector" disabled="{{!repoSelected}}" label="Branch Selection">
                            <paper-listbox id="branchListbox" class="dropdown-content">
                                <template is="dom-repeat" items="{{currentRepo.canonicalBranchList}}">
                                    <paper-item>{{item.name}}</paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>
                        <paper-icon-button id="updateStatusBtn" on-tap="_updateCurrentRepoInfo" icon="refresh" style="color: white" hidden$="{{!repoSelected}}"></paper-icon-button>
                    </div>
                    <div id="statusContainer">
                        <span style="-webkit-user-select: none; font-family: sans-serif; font-size: 10pt; vertical-align: middle; text-align: center; display: table-cell;">File Differences</span>
                        <paper-badge id="statusBadge" label="{{changedFileCount}}"></paper-badge>
                    </div>
                </paper-toolbar>
                <div id="horizDivider" style="width:100%; background: black; height:1px"></div>
                <div style="display: flex; height: 100%; width: 100%;">
                    <div id="commandPanel" style="background: whitesmoke; height: 100%; width: 30%; overflow-y: auto;">
                        <button on-click="inCommandsToggle" class="heading">Inbound Commands</button>
                        <iron-collapse id="inCommands">
                            <div style="display: flex; justify-content: center; flex-direction: column;">
                                <paper-button id="pullCommand" raised on-tap="_pull" disabled="{{!repoSelected}}">Pull</paper-button>
                            </div>
                        </iron-collapse>
                        <button on-click="outCommandsToggle" class="heading">Outbound Commands</button>
                        <iron-collapse id="outCommands">
                            <div style="display: flex; justify-content: center; flex-direction: column;">
                                <paper-button id="pushCommand" raised on-tap="_push" disabled="[[!commitCounter]]">Push</paper-button>
                            </div>
                        </iron-collapse>
                        <button on-click="localCommandsToggle" class="heading">Local Commands</button>
                        <iron-collapse id="localCommands">
                            <div style="display: flex; justify-content: center; flex-direction: column;">
                                <paper-button raised on-tap="_toggleNewBranch" disabled="{{!repoSelected}}">New Local Branch</paper-button>
                                <paper-button id="commitCommand" raised on-tap="_commit" disabled="[[!changedFileCount]]">Commit</paper-button>
                                <paper-button id="resetRepo" raised on-tap="_reset" disabled="{{!repoSelected}}">Reset</paper-button>
                                <paper-button id="deleteRepo" raised on-tap="_delete" disabled="{{!repoSelected}}">Delete</paper-button>
                            </div>
                        </iron-collapse>
                    </div>
                  <textarea id="commandArea" style="width: 70%; height: 100%; background:darkgrey; color:whitesmoke" readonly> </textarea>
                </div>

            </div>
            <div id="divider" style="width:2px; background: grey;"></div>
            <div id="terminalSide" style="width:50%; background: black;">
                <paper-toolbar style="background: black; display: flex; justify-content: center;">
                    <div>TERMINAL</div>
                    <paper-button class="terminalSettings" id="clearButton" raised on-tap="_clearTerminal" style="left: 0px;">Clear</paper-button>
                    <paper-button class="terminalSettings" id="styleButton" raised on-tap="_toggleStyleDialog" style="left: 58px;">Styles</paper-button>
                </paper-toolbar>
                <textarea id="terminal" style="resize: none; width: 100%; height: 100%; background: black; border-color: grey;" readonly ></textarea>
            </div>
        </div>
        <paper-tooltip for="cloneDest" offset="0">{{repoFormDestination}}</paper-tooltip>
        <paper-tooltip for="repoAdd" offset="-10" position="top">Add a repo</paper-tooltip>
        <paper-tooltip for="updateStatusBtn" offset="-10" position="top">Update status</paper-tooltip>
    </template>
</dom-module>
<script>

    Polymer({
        is: "easy-hub-main",

        listeners: {
            'cloneDialog.iron-overlay-closed': '_clearCloneInput',
            'repoSelector.iron-select': '_updateCurrentRepoInfo',
            'branchSelector.iron-select': '_handleBranchSelected'
        },

        properties: {
            applicationData: {
                type: Object,
                value: {
                    repoArray: [],
                    OS: "",
                }
            },

            repoFormDestination: {
                type: String,
                value: ""
            },
            // path in the filesystem to current repo
            currentRepo:{
                type: Object,
                value: {}
            },
            commandType:{
              type: String,
                value : ""
            },

            commitCounter:{
                type: Number,
                value:0
            },

            OS_SLASH: {
                type: String,
                value: "/"
            },
            DATA_PATH: {
                type: Object,
                value: {
                    READ: "",
                    WRITE: "",
                }
            },
            repoSelected: {
                type: Boolean,
                value: false
            },
            changedFileCount: {
                type: Number,
                value: 0
            },
            changedFiles: {
                type: Array,
                value: function () {
                    return [];
                }
            }
        },

        inCommandsToggle: function(e) {
            this.$.inCommands.toggle();
        },
        outCommandsToggle: function() {
            this.$.outCommands.toggle();
        },
        localCommandsToggle: function() {
            this.$.localCommands.toggle();
        },

        _setTerminalStyles: function () {
            this.customStyle["--terminal-font-size"] = this.$.fontInput.value+"pt";
            this.customStyle["--terminal-font-family"] = this.$.fontSelector.value;
            this.updateStyles();
            this._toggleStyleDialog();
        },

        _toggleStyleDialog: function () {
            this.$.styleDialog.toggle();
        },

        _clearTerminal: function () {
            this.$.terminal.value = "";
        },

        /**
         * performs one of two actions when selecting a branch:
         * 1) switch to existing local branch
         * 2) create new local branch to track selected remote branch
         * @private
         */
        _handleBranchSelected: function (e) {
            if(e) {
                return;
            }
            this.set('currentRepo.currentBranch', "");
            // get selected branch
            var label = this.$.branchSelector.selectedItemLabel;
            var finalName = label;
            var proc;
            if(label.includes('origin/')) {
                // branch is remote, create a local branch to track it
                finalName = label.substring(label.lastIndexOf("/")+1);
                proc = gitUtils.trackRemoteBranch(finalName, label, this.currentRepo.destination+this.currentRepo.name);
            } else {
                // branch is local, simply switch to it
                proc = gitUtils.switchBranch(label, this.currentRepo.destination+this.currentRepo.name);
            }
            if(proc.process.status == 0) {
                var result = this.get_process_response(proc);
                console.log(result);
                this.set('currentRepo.currentBranch', finalName);
            } else {
                var result = this.get_process_error(proc);
                console.error(result);
                this.set('currentRepo.currentBranch', "");
            }
        },

        _newLocalBranch: function() {
            var newBranchName = this.$.newBranchName.value;
            var branches = _.map(this.currentRepo.canonicalBranchList, 'name');
            if(_.includes(branches, newBranchName)) {
//                console.error('Branch with given name already exists: ' + newBranchName);
                this.$.newBranchName.value = "";
                this._toggleNewBranch();
                this.$.toastNotify.text = 'Branch with given name already exists: ' + newBranchName;
                this.$.toastNotify.open();
                return;
            }
            var proc = gitUtils.createNewBranch(newBranchName, this.currentRepo.destination+this.currentRepo.name);
            if(proc.process.status == 0) {
                // update branches to reflect new branch
                this._updateRepoBranches();
                this.set('currentRepo.currentBranch', newBranchName);
                // set the branch selector to the new branch
                this.async(function () {
                    this._selectBranch(newBranchName);
                }.bind(this), 100);
            } else {
                var result = this.get_process_error(proc);
                console.error(result);
            }
            this.$.newBranchName.value = "";
            this._toggleNewBranch();
        },

        _selectBranch: function (branchName) {
            var items = _.map(this.currentRepo.canonicalBranchList, 'name');
            var branchIndex = items.indexOf(branchName);
            this.$.branchListbox.selected = branchIndex;
        },

        _cancelNewBranch: function() {
            this.$.newBranchName.value = "";
            this._toggleNewBranch();
        },

        /**
         * runs 'git status' and parses the result from the terminal to determine how many modifications have been
         * made. updates a badge above the repo-selector accordingly
         * @private
         **/
        _updateChangeStatus: function(isCommit) {
            // run git status
            var proc = gitUtils.status(this.currentRepo.destination+this.currentRepo.name);
            var numModifications = 0;
            var numUntracked = 0;
            var index = 0;

            if(proc.process.status == 0) {
                var result = this.get_process_response(proc).split('\n');
                for(i=0; i<result.length; i++) {
                    if(result[i].includes('modified:') || result[i].includes('deleted: ')) {
                        numModifications += 1;
                        this.changedFiles.push(result[i].replace('\t', ''));
                    } else if(result[i].includes('Untracked files:')) {
                        // mark index of untracked files
                        index = i+2;
                        break;
                    } else if(result[i].includes('nothing to commit')) {
                        this.set('changedFileCount', 0);
                        return;
                    }
                }
                // loop through untracked files
                if(index){
                    for(var i = index; i < result.length; i++){
                        if(result[i] && !result[i].includes('no changes added to commit') && !result[i].includes('nothing added to commit')) {
                            this.changedFiles.push(result[i].replace('\t', ''));
                            numUntracked += 1;
                        }
                    }
                }
            } else {
                console.error(this.get_process_error(proc));
            }
            if (!isCommit){
                this.writeTerminal("git status \n"+this.get_process_response(proc),5);
            }
            // update file count badge
            this.set('changedFileCount', numModifications + numUntracked);
        },

        /**
         * update the current repo information
         * @private
         **/
        _updateCurrentRepoInfo: function() {

            this.set('repoSelected', true);
            // get selected repo
            var label = this.$.repoSelector.selectedItemLabel;
            // get path of selected repo
            this.currentRepo = this.getRepoByName(label);
            // update branches of repository
            this._updateRepoBranches();
            // fetch status and update notification accordingly
            this._updateChangeStatus();
            var currentBranch = this._getCurrentBranch();
            this.set('currentRepo.currentBranch', currentBranch);
            this._selectBranch(currentBranch);
        },

        /**
         * Populates the remote and local branches, as well as canonical branch list
         * @private
         */
        _updateRepoBranches: function() {
            this.currentRepo.remoteBranches = [];
            this.currentRepo.localBranches = [];
            var branches = [];
            var result = [];
            result.push(gitUtils.getRemoteBranches(this.currentRepo.destination+this.currentRepo.name));
            result.push(gitUtils.getLocalBranches(this.currentRepo.destination+this.currentRepo.name));
            for(var i=0; i<2; i++) {
                if (result[i].process.status == 0) {
                    var found = this.get_process_response(result[i]).split('\n');
                    for (var j = 0; j < found.length; j++) {
                        // if string is not empty and does not include head pointer
                        if (found[j] && !found[j].includes("/HEAD ->")) {
                            if(found[j].startsWith("* ")) {
                                found[j] = found[j].substring(2);
                            }
                            branches.push({name: found[j].trim()});
                        }
                    }
                    if(i==0) {
                        this.set('currentRepo.remoteBranches', branches);
                    } else {
                        this.set('currentRepo.localBranches', branches);
                    }
                    branches = [];
                } else {
                    console.error(this.get_process_error(result));
                }
            }
            this._setCanonicalBranchList();
        },

        /**
         * Takes the remote and local branch lists for the current repo, and combines pairs into a single listing for
         * output to the user
         * @private
         */
        _setCanonicalBranchList: function() {
            var remotes = _.map(this.currentRepo.remoteBranches, 'name');
            var locals = _.map(this.currentRepo.localBranches, 'name');
            this.set('currentRepo.canonicalBranchList', []);
            var canonical = [];
            var remoteName = "origin";
            // add all local branches to canonical list
            for(var i=0; i<locals.length; i++) {
                canonical.push({name: locals[i]});
            }
            // only display remote branch if local with same name does not exist
            for(var i=0; i<remotes.length; i++) {
                var name = remotes[i].substring(remotes[i].lastIndexOf("/")+1);
                if(!_.includes(locals, name)) {
                    canonical.push({name: remotes[i]});
                }
            }
            this.set('currentRepo.canonicalBranchList', canonical);
        },


        _updateApplicationData: function() {
            jsonfile.writeFile(this.DATA_PATH.WRITE, {applicationData:this.applicationData}, function (err) {
                if(err){
                    console.error(err);
                }
            });
        },

        _retrieveApplicationDataFromJSON: function() {
            // Promises are magic. That's all I know
            return Promise.all([
                $.getJSON(this.DATA_PATH.READ, function(json) {
                    this.set('applicationData', json.applicationData);
                }.bind(this)),
            ]);
        },

        _clearCloneInput: function () {
            this.$.cloneRemote.value = "";
            this.$.cloneDest.value = "";
        },

        _toggleNewBranch: function() {
            this.$.newBranchDialog.toggle();
        },

        _toggleClone: function() {
            this.$.cloneDialog.toggle();
        },

        _initLocal: function() {
            gitUtils.init(this.$.cloneDest.value);
        },

        _cloneInfoIsValid: function () {
            if(this.$.cloneDest.value && this.$.cloneRemote.value){
                var gitUrlRegex = /(?:git|ssh|https?|git@[\w\.]+):(?:\/\/)?[\w\.@:\/~_-]+\.git(?:\/?|\#[\d\w\.\-_]+?)$/;
                return gitUrlRegex.test(this.$.cloneRemote.value);
            }
        },

        _clone: function() {
            if(this._cloneInfoIsValid()){
                var remote = this.$.cloneRemote.value;
                var name = remote.split("/").pop().split(".")[0];
                var dest = this.$.cloneDest.value + this.OS_SLASH;
                var repo = {url: remote, destination: dest, name: name, type: "git"};
                if(!this.getRepoByUrl(remote)){
                    var cloneProc = gitUtils.clone(remote, dest);
                    if(cloneProc.process.status == 0){
                        this.$.cloneDialog.toggle();
                        if(this.applicationData.repoArray.length == 0){
                            this.set('applicationData.repoArray', [repo]);
                        }
                        else{
                            this.push('applicationData.repoArray', repo);
                        }
                        this.writeTerminal(cloneProc.command+"\nClone Successful!");
                        this.$.toastNotify.text = "Repo added!";
                        this.$.toastNotify.open();
                        this._updateApplicationData();
                    }
                    else{
                        this.$.toastNotify.text = "Error cloning repo!";
                        this.$.toastNotify.open();
                    }
                }
                else{
                    this.$.toastNotify.text = "Repo already exists!";
                    this.$.toastNotify.open();
                }
            }
            else{
                this.$.toastNotify.text = "Invalid repo information ya silly cactus!";
                this.$.toastNotify.open();
            }

        },

        _push:function(){
                this.set('commandType', "Push Message");
                this._setVal();
        },

        _pull:function(){
            this.set('commandType', "Pull Message");
            this._setVal();
        },

        _commit:function(){
            this._updateChangeStatus(1);
            if(this.changedFileCount==0){
                this.$.toastNotify.text = "No Changes Found";
                this.$.toastNotify.open();

            }
            else {
                this.set('commandType', "Commit Message");
                this.$.dialog.toggle();
            }
        },

        _reset:function(){
            this.set('commandType', "Reset Message");
            this._setVal();
        },

        _setVal:function(){
            switch(this.commandType) {
                case("Commit Message"):
                    gitUtils.add(this.currentRepo.destination+this.currentRepo.name, this.OS_SHELL);
                    var commitProc = gitUtils.commit(this.$.commandInput.value, this.currentRepo.destination+this.currentRepo.name, this.OS_SHELL);
                    if (commitProc) {
                        if(this.$.commandInput.value) {
                            this.$.dialog.toggle();
                            this.writeTerminal("git -a -m * "+"\""+this.$.commandInput.value+"\"");
                            this._updateChangeStatus(1);
                            this.$.commandInput.value="";
                            this.commitCounter++;
                        }else{
                            this.$.toastNotify.text = "No Message in Input Box, Cannot Commit";
                            this.$.toastNotify.open();
                        }
                    }
                    break;

                case("Push Message"):
                    var pushProc = gitUtils.push(this.currentRepo.branches,this.currentRepo.destination+this.currentRepo.name, this.OS_SHELL);
                    if (pushProc) {
                            this.writeTerminal("git push origin "+this.currentRepo.branches);
                            this.commitCounter=0;
                    }
                    break;

                case("Pull Message"):
                    var pullProc = gitUtils.pull(this.currentRepo.destination+this.currentRepo.name);
                    if (pullProc) {
                        this.writeTerminal("git pull");
                        this.commitCounter=0;
                    }
                    break;

                case("Reset Message"):
                    var resetProc = gitUtils.reset(this.currentRepo.destination+this.currentRepo.name);
                    gitUtils.clean(this.currentRepo.destination+this.currentRepo.name);
                    if (resetProc) {
                        this.writeTerminal("git reset --hard \n> git clean -df");
                        this.commitCounter=0;

                    }
                    break;

                default:
                    console.warn("Default Hit in Switch");
            }
        },

        getRepoByUrl: function (url) {
            return _.find(this.applicationData.repoArray, 'url', url);
        },

        getRepoByPath: function (path) {
            return _.find(this.applicationData.repoArray, 'destination', path);
        },

        getRepoByName: function (name) {
            return _.find(this.applicationData.repoArray, 'name', name);
        },

        _openFolderDialog: function () {
            var remote = require('electron').remote;
            var dialog = remote.dialog;
            dialog.showOpenDialog({
                title:"Select a folder",
                properties: ["openDirectory"],
                defaultPath: "C:\\"
            },function (folderPath) {
                this.set('repoFormDestination', folderPath);
            }.bind(this));
        },

        _osCheck: function () {
            var OSType = "Not Supported";
            if (window.navigator.appVersion.indexOf("Win") != -1){
                OSType = "Windows";
                this.DATA_PATH.WRITE = "./resources/app/data.json";
                this.DATA_PATH.READ = "./data.json";
                OS_SHELL = "cmd.exe";
                //possibly set this.OS_SLASH
            }
            else if (window.navigator.appVersion.indexOf("Mac") != -1){
                OSType = "MacOS";
                this.DATA_PATH.WRITE = "data.json";
                this.DATA_PATH.READ = "data.json";
                OS_SHELL = "/bin/sh";
                //possibly set this.OS_SLASH
            }
            else if (window.navigator.appVersion.indexOf("Linux") != -1){
                OSType = "Linux";
                //possibly set this.OS_SLASH
                this.DATA_PATH.WRITE = "data.json";
                this.DATA_PATH.READ = "data.json";
                OS_SHELL = "/bin/bash";
            }

            //write the OS Type to file
            this.applicationData.OS = OSType;
        },

        _repoCheck: function () {
            for (var i = 0; i < this.applicationData.repoArray.length; i++){
               //This if statement only occurs when a repo has been removed
               if (!fs.existsSync(this.applicationData.repoArray[i].destination + this.applicationData.repoArray[i].name)){
                   //now we must remove repoArray[i]
                   this.splice('applicationData.repoArray',i, 1);
               }
            }
            this._updateApplicationData();
        },

        _delete: function () {
            var actualPath = this.currentRepo.destination;
            var deleteProc = repoDelete(this.currentRepo.name, actualPath);
            this.writeTerminal("Repo Deleted");
            //deleting current_repo from repository selection
            for (var i = 0; i < this.applicationData.repoArray.length; i++){
                //This if statement only occurs when a repo has been removed
                if ((this.applicationData.repoArray[i].destination == this.currentRepo.destination) && (this.applicationData.repoArray[i].name == this.currentRepo.name)){
                    //now we must remove repoArray[i]
                    this.splice('applicationData.repoArray',i, 1);
                }
            }
            this._updateApplicationData();
            this.set("repoSelected",false);
        },

        _getCurrentBranch: function () {
            var branchProc = gitUtils.getCurrentBranch(this.currentRepo.destination+this.currentRepo.name);
            return this.get_process_response(branchProc).trim();
        },

        writeTerminal: function (input,speed){
            if (!speed){
                speed=25;
            }
            var temp = "\n> "+ input;
            Sequencr.for(0, temp.length, function (i) {
                this.$.terminal.value += temp[i];
                if(i == temp.length-1){
                    this.$.terminal.scrollTop = Number.MAX_SAFE_INTEGER;
                }
            }.bind(this),speed,null);

        },

        ready: function (e) {
            // set styles
            this.customStyle["--terminal-font-size"] = '10pt';
            this.customStyle["--terminal-font-family"] = 'Courier New';
            this.updateStyles();

            $( "#pullCommand" ).hover(
                function(){
                    this.$.commandArea.value=gitInfo.pullMessage;
                }.bind(this),
                function(){
                    this.$.commandArea.value="";
                }.bind(this)
            );

            $( "#pushCommand" ).hover(
                function(){
                   this.$.commandArea.value=gitInfo.pushMessage;
                }.bind(this),
                function(){
                    this.$.commandArea.value="";
                }.bind(this)
            );

            $( "#commitCommand" ).hover(
                function(){
                    this.$.commandArea.value=gitInfo.commitMessage;
                }.bind(this),
                function(){
                    this.$.commandArea.value="";
                }.bind(this)
            );

            $( "#repoAdd" ).hover(
                function(){
                    this.$.commandArea.value=gitInfo.cloneMessage;
                }.bind(this),
                function(){
                    this.$.commandArea.value="";
                }.bind(this)
            );

            $( "#deleteRepo" ).hover(
                function(){
                    this.$.commandArea.value=gitInfo.deleteMessage;
                }.bind(this),
                function(){
                    this.$.commandArea.value="";
                }.bind(this)
            );

            $( "#resetRepo" ).hover(
                function(){
                    this.$.commandArea.value=gitInfo.resetMessage;
                }.bind(this),
                function(){
                    this.$.commandArea.value="";
                }.bind(this)
            );


            this._osCheck();
            // check if we have data.JSON
            if (fs.existsSync(this.DATA_PATH.WRITE)) {
                // .then means that everything within is executed after any and ALL (even asynchronous) calls are completed
                this._retrieveApplicationDataFromJSON().then(function(){
                    if(!this.applicationData.repoArray){
                        this.applicationData.repoArray = [];
                    }
                    this._repoCheck();
                }.bind(this));
            }
            else{
                this.applicationData.repoArray = [];
                this._updateApplicationData();
            }
        },

        get_process_response: function(proc) {
            return String(proc.process.output[1]);
        },

        get_process_error: function(proc) {
            if(proc.process.output == null) {
                return String(proc.process.error);
            }
            return String(proc.process.output[2]);
        }
    });
</script>

